(function($){Drupal.behaviors.zoomimage={attach:function(){$('a.imagezoom').click(function(e){e.preventDefault()});$('li.imagezoom-thumb-image').click(function(e){swap(e,$(this))});switch(Drupal.settings.imagezoom.zoom_type){case'popup':$('a.imagezoom').mouseenter(function(e){zoom_popup($(this))});$('a.imagezoom').mousemove(function(e){shift(e,$(this))});$('a.imagezoom').mouseleave(function(e){reset()});break;case'inner':$('a.imagezoom').mouseenter(function(e){zoom_inner($(this))});$('a.imagezoom').mousemove(function(e){shift(e,$(this))});$('a.imagezoom').mouseleave(function(e){reset()});break}function zoom_popup(obj){var zoomImageWrapper,zoomImage,title;zoomImageWrapper=$('<div/>',{'id':'zoom-img-wrapper','class':'popup'});zoomImage=$('<img/>',{'src':obj.attr('href'),'id':'zoom-img'});zoomImageWrapper.appendTo(obj.parent());zoomImage.appendTo('#zoom-img-wrapper');if(Drupal.settings.imagezoom.display_title==1){title='<div class="zoom-img-title">'+obj.children('img').attr('title')+'</div>';zoomImageWrapper.append(title)}$('#zoom-img-wrapper').parent('div').css('position','relative')}function zoom_inner(obj){var image,zoomImageWrapper,zoomImage;image=obj.children('img');obj.css({'position':'relative','display':'block','height':image.height(),'width':image.width()});zoomImageWrapper=$('<div/>',{'id':'zoom-img-wrapper','class':'inner'});zoomImageWrapper.css({'height':image.height(),'width':image.width()});zoomImage=$('<img/>',{src:obj.attr('href'),id:'zoom-img'});zoomImageWrapper.appendTo(obj);zoomImage.appendTo('#zoom-img-wrapper')}function reset(){$('#zoom-img-wrapper').remove()}function shift(e,obj){var image,zoomImage,offset,mouseX,mouseY,ratioX,ratioY,posX,posY;image=obj.children('img');zoomImage=$('#zoom-img');offset=image.offset();mouseX=e.pageX-offset.left;mouseY=e.pageY-offset.top;ratioX=(zoomImage.width()-$('#zoom-img-wrapper').width())/image.width();ratioY=(zoomImage.height()-$('#zoom-img-wrapper').height())/image.height();posX=mouseX*ratioX;posY=mouseY*ratioY;if(posX>zoomImage.width()){posX=zoomImage.width()}if(posY>zoomImage.height()){posY=zoomImage.height()}$('#zoom-img').css('left',(posX*-1)+'px');$('#zoom-img').css('top',(posY*-1)+'px')}function swap(e,obj){e.preventDefault();var mainSrc,zoomSrc,thumbSrc,newMainSrc,newZoomSrc,pos;mainSrc=$('a.imagezoom img').attr('src');pos=mainSrc.lastIndexOf('/');mainSrc=mainSrc.substr(0,pos)+'/';zoomSrc=$('a.imagezoom').attr('href');pos=zoomSrc.lastIndexOf('/');zoomSrc=zoomSrc.substr(0,pos)+'/';thumbSrc=obj.children('a').children('img').attr('src');pos=thumbSrc.lastIndexOf('/');thumbSrc=thumbSrc.substr(pos+1);newMainSrc=mainSrc+thumbSrc;newZoomSrc=zoomSrc+thumbSrc;$('a.imagezoom img').attr('src',newMainSrc);$('a.imagezoom').attr('href',newZoomSrc);$('div.imagezoom-thumb.active').removeClass('active');obj.addClass('active');if(Drupal.settings.imagezoom.hide_thumbs==1){$('div.imagezoom-thumb.imagezoom-thumb-hide').removeClass('imagezoom-thumb-hide');obj.parent('div').addClass('imagezoom-thumb-hide')}}}}})(jQuery);
